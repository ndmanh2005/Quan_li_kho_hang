@model IEnumerable<QuanLyKhoHang.Models.RolePermission>

@{
    ViewData["Title"] = "Phân quyền cho nhóm: " + ViewBag.RoleName;
    var functions = ViewBag.Functions as List<string>;
}

<h1 class="display-5">@ViewData["Title"]</h1>
<hr />

<form asp-action="Authorize" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" name="roleId" value="@ViewBag.RoleId" />

    <table class="table table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th>Tên chức năng</th>
                <th class="text-center">Xem</th>
                <th class="text-center">Thêm</th>
                <th class="text-center">Sửa</th>
                <th class="text-center">Xóa</th>
                <th class="text-center">Nhập file</th>
                <th class="text-center">Xuất file</th>
            </tr>
        </thead>
        <tbody>
            @for (var i = 0; i < functions.Count; i++)
            {
                var functionCode = functions[i];
                var currentPermission = Model.FirstOrDefault(p => p.FunctionCode == functionCode);

                <tr>
                    <td>
                        <strong>@functionCode</strong>
                        <input type="hidden" name="permissions[@i].FunctionCode" value="@functionCode" />
                    </td>
                    <td class="text-center">
                        <input type="checkbox" class="form-check-input" name="permissions[@i].CanView" value="true" @(currentPermission?.CanView == true ? "checked" : "") />
                    </td>
                    <td class="text-center">
                        <input type="checkbox" class="form-check-input" name="permissions[@i].CanCreate" value="true" @(currentPermission?.CanCreate == true ? "checked" : "") />
                    </td>
                    <td class="text-center">
                        <input type="checkbox" class="form-check-input" name="permissions[@i].CanEdit" value="true" @(currentPermission?.CanEdit == true ? "checked" : "") />
                    </td>
                    <td class="text-center">
                        <input type="checkbox" class="form-check-input" name="permissions[@i].CanDelete" value="true" @(currentPermission?.CanDelete == true ? "checked" : "") />
                    </td>
                     <td class="text-center">
                        <input type="checkbox" class="form-check-input" name="permissions[@i].CanImport" value="true" @(currentPermission?.CanImport == true ? "checked" : "") />
                    </td>
                     <td class="text-center">
                        <input type="checkbox" class="form-check-input" name="permissions[@i].CanExport" value="true" @(currentPermission?.CanExport == true ? "checked" : "") />
                    </td>
                </tr>
            }
        </tbody>
    </table>
    
    <div class="form-group mt-3">
        <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
        <a asp-action="Index" class="btn btn-secondary">Quay lại danh sách</a>
    </div>
</form>